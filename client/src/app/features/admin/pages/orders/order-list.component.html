<div class="order-list">
  <div class="page-header">
    <div class="header-left">
      <p class="total-count">Ukupno: <strong>{{ totalCount() }}</strong> narudžbi</p>
    </div>
    <div class="header-actions">
      <div class="filter-tabs">
        <button
          class="filter-tab"
          [class.active]="statusFilter() === null"
          (click)="onStatusFilter(null)">
          Sve
        </button>
        <button
          class="filter-tab"
          [class.active]="statusFilter() === OrderStatus.Processing"
          (click)="onStatusFilter(OrderStatus.Processing)">
          U obradi
        </button>
        <button
          class="filter-tab"
          [class.active]="statusFilter() === OrderStatus.OnDelivery"
          (click)="onStatusFilter(OrderStatus.OnDelivery)">
          Dostava
        </button>
      </div>
      <div class="search-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Pretraži po korisniku..."
          [value]="searchQuery()"
          (input)="onSearch($event)"
        />
      </div>
    </div>
  </div>

  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Učitavanje narudžbi...</p>
    </div>
  } @else if (orders().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
        </svg>
      </div>
      @if (searchQuery() || statusFilter() !== null) {
        <h3>Nema rezultata</h3>
        <p>Nema narudžbi koje odgovaraju filteru</p>
      } @else {
        <h3>Nema narudžbi</h3>
        <p>Trenutno nema narudžbi u sistemu.</p>
      }
    </div>
  } @else {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Kupac</th>
            <th>Datum</th>
            <th>Stavke</th>
            <th>Iznos</th>
            <th>Status</th>
            <th>Akcije</th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders(); track order.id) {
            <tr>
              <td class="cell-id">#{{ order.id }}</td>
              <td class="cell-user">
                @if (order.userProfileImageUrl) {
                  <img [src]="getImageUrl(order.userProfileImageUrl)" [alt]="order.userName" class="user-avatar-img">
                } @else {
                  <div class="user-avatar">
                    {{ getInitials(order.userName) }}
                  </div>
                }
                <span class="user-name">{{ order.userName }}</span>
              </td>
              <td class="cell-date">
                {{ formatDate(order.purchaseDate) }}
              </td>
              <td class="cell-items">
                {{ order.itemCount }} {{ order.itemCount === 1 ? 'proizvod' : 'proizvoda' }}
              </td>
              <td class="cell-amount">
                {{ formatCurrency(order.totalAmount) }}
              </td>
              <td>
                <span class="status-badge" [class]="getStatusClass(order.status)">
                  @if (order.status === OrderStatus.Processing) {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 0 0-3.213-9.193 2.056 2.056 0 0 0-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 0 0-10.026 0 1.106 1.106 0 0 0-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                    </svg>
                  }
                  {{ getStatusName(order.status) }}
                </span>
              </td>
              <td class="cell-actions">
                <button class="btn-icon" title="Detalji" (click)="viewOrder(order)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  </svg>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (totalPages() > 1) {
      <div class="pagination">
        <button
          class="pagination-btn"
          [disabled]="currentPage() === 1"
          (click)="goToPage(currentPage() - 1)">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg>
        </button>
        <span class="pagination-info">
          Stranica {{ currentPage() }} od {{ totalPages() }}
        </span>
        <button
          class="pagination-btn"
          [disabled]="currentPage() === totalPages()"
          (click)="goToPage(currentPage() + 1)">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
          </svg>
        </button>
      </div>
    }
  }
</div>

<!-- Order Detail Modal -->
@if (selectedOrder()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Narudžba #{{ selectedOrder()?.id }}</h2>
        <button class="modal-close" (click)="closeModal()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      @if (isLoadingDetail()) {
        <div class="modal-loading">
          <div class="spinner"></div>
          <p>Učitavanje detalja...</p>
        </div>
      } @else if (orderDetail()) {
        <div class="modal-body">
          <div class="order-info-grid">
            <div class="info-card">
              <h4>Kupac</h4>
              <div class="customer-info">
                @if (orderDetail()?.userProfileImageUrl) {
                  <img [src]="getImageUrl(orderDetail()?.userProfileImageUrl)" [alt]="orderDetail()?.userName" class="customer-avatar-img">
                } @else {
                  <div class="customer-avatar">
                    {{ getInitials(orderDetail()?.userName || '') }}
                  </div>
                }
                <span class="customer-name">{{ orderDetail()?.userName }}</span>
              </div>
            </div>
            <div class="info-card">
              <h4>Datum narudžbe</h4>
              <p>{{ formatDate(orderDetail()?.purchaseDate || '') }}</p>
            </div>
            <div class="info-card">
              <h4>Status</h4>
              <span class="status-badge" [class]="getStatusClass(orderDetail()?.status || 0)">
                {{ getStatusName(orderDetail()?.status || 0) }}
              </span>
            </div>
            <div class="info-card">
              <h4>Ukupno</h4>
              <p class="total-amount">{{ formatCurrency(orderDetail()?.totalAmount || 0) }}</p>
            </div>
          </div>

          <div class="order-items-section">
            <h4>Stavke narudžbe ({{ orderDetail()?.itemCount }})</h4>
            <div class="items-list">
              @for (item of orderDetail()?.items; track item.id) {
                <div class="item-card">
                  @if (item.productImageUrl) {
                    <img [src]="getImageUrl(item.productImageUrl)" [alt]="item.productName" class="item-image">
                  } @else {
                    <div class="item-image-placeholder">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                      </svg>
                    </div>
                  }
                  <div class="item-details">
                    <span class="item-name">{{ item.productName }}</span>
                    <span class="item-quantity">{{ item.quantity }} x {{ formatCurrency(item.unitPrice) }}</span>
                  </div>
                  <span class="item-total">{{ formatCurrency(item.totalPrice) }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
}
