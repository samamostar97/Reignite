<app-header [activePath]="'/cart'" />
<app-ember-background density="sparse" [maxOpacity]="0.3" />

<main class="cart-page">
  <div class="cart-container">
    <h1 class="cart-title">Korpa</h1>

    @if (cartService.isEmpty()) {
      <div class="empty-cart">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="empty-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
        </svg>
        <h2>Vaša korpa je prazna</h2>
        <p>Dodajte proizvode u korpu da biste nastavili s kupovinom.</p>
        <a routerLink="/shop" class="btn-shop">Nastavi Kupovinu</a>
      </div>
    } @else {
      <div class="cart-layout">
        <div class="cart-items">
          @for (item of cartService.items(); track item.productId) {
            <div class="cart-item">
              <a [routerLink]="['/shop', item.productId]" class="item-image">
                @if (getImageUrl(item.productImageUrl)) {
                  <img [src]="getImageUrl(item.productImageUrl)" [alt]="item.productName" />
                } @else {
                  <div class="image-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909M3 3h18v18H3V3Z" />
                    </svg>
                  </div>
                }
              </a>

              <div class="item-details">
                <a [routerLink]="['/shop', item.productId]" class="item-name">{{ item.productName }}</a>
                <span class="item-price">{{ formatPrice(item.unitPrice) }} KM</span>
              </div>

              <div class="item-quantity">
                <button class="qty-btn" (click)="decrement(item.productId, item.quantity)" [disabled]="item.quantity <= 1">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                  </svg>
                </button>
                <input type="number" [value]="item.quantity" min="1" max="100" (change)="updateQuantity(item.productId, $event)" class="qty-input" />
                <button class="qty-btn" (click)="increment(item.productId, item.quantity)">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                  </svg>
                </button>
              </div>

              <div class="item-total">
                <span>{{ formatPrice(item.unitPrice * item.quantity) }} KM</span>
              </div>

              <button class="remove-btn" (click)="cartService.removeItem(item.productId)" title="Ukloni">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
              </button>
            </div>
          }
        </div>

        <div class="cart-summary">
          <h2 class="summary-title">Pregled Narudžbe</h2>
          <div class="summary-row">
            <span>Proizvodi ({{ cartService.count() }})</span>
            <span>{{ formatPrice(cartService.total()) }} KM</span>
          </div>
          <div class="summary-row">
            <span>Dostava</span>
            <span class="free-shipping">Besplatna</span>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-row total">
            <span>Ukupno</span>
            <span>{{ formatPrice(cartService.total()) }} KM</span>
          </div>
          <a routerLink="/checkout" class="btn-checkout">Nastavi na Plaćanje</a>
          <a routerLink="/shop" class="btn-continue">Nastavi Kupovinu</a>
        </div>
      </div>
    }
  </div>
</main>
