<div class="tab-panel">
  <h3 class="tab-title">Profil</h3>
  <p class="tab-description">Upravljajte svojim li훾nim podacima i profilnom slikom.</p>

  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>U훾itavanje profila...</p>
    </div>
  } @else {
    <!-- Profile Image Section -->
    <div class="image-section">
      <div class="image-preview"
           [class.dragging]="isDragging()"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)">
        @if (imageUrl()) {
          <img [src]="imageUrl()" alt="Profilna slika" class="avatar-img" />
        } @else {
          <div class="avatar-placeholder">
            <span>{{ getInitials() }}</span>
          </div>
        }
        @if (isUploading()) {
          <div class="upload-overlay">
            <div class="spinner-small"></div>
          </div>
        }
      </div>
      <div class="image-actions">
        <label class="btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
          </svg>
          Postavi sliku
          <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
        </label>
        @if (imageUrl()) {
          <button class="btn-outline btn-danger-outline" (click)="removeImage()" [disabled]="isUploading()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
            </svg>
            Ukloni
          </button>
        }
        <p class="image-hint">Prevucite sliku ili kliknite. Maks. 5MB.</p>
      </div>
    </div>

    <!-- Profile Form -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="profile-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Ime</label>
          <input type="text" formControlName="firstName" class="form-input"
                 [class.invalid]="hasError('firstName', 'required') || hasError('firstName', 'minlength')" />
          @if (hasError('firstName', 'required')) {
            <span class="form-error">Ime je obavezno.</span>
          }
          @if (hasError('firstName', 'minlength')) {
            <span class="form-error">Ime mora imati najmanje 2 znaka.</span>
          }
        </div>
        <div class="form-group">
          <label class="form-label">Prezime</label>
          <input type="text" formControlName="lastName" class="form-input"
                 [class.invalid]="hasError('lastName', 'required') || hasError('lastName', 'minlength')" />
          @if (hasError('lastName', 'required')) {
            <span class="form-error">Prezime je obavezno.</span>
          }
          @if (hasError('lastName', 'minlength')) {
            <span class="form-error">Prezime mora imati najmanje 2 znaka.</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Korisni훾ko ime</label>
          <input type="text" formControlName="username" class="form-input"
                 [class.invalid]="hasError('username', 'required') || hasError('username', 'minlength')" />
          @if (hasError('username', 'required')) {
            <span class="form-error">Korisni훾ko ime je obavezno.</span>
          }
          @if (hasError('username', 'minlength')) {
            <span class="form-error">Mora imati najmanje 3 znaka.</span>
          }
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" formControlName="email" class="form-input"
                 [class.invalid]="hasError('email', 'required') || hasError('email', 'email')" />
          @if (hasError('email', 'required')) {
            <span class="form-error">Email je obavezan.</span>
          }
          @if (hasError('email', 'email')) {
            <span class="form-error">Neispravan email format.</span>
          }
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Telefon</label>
        <input type="tel" formControlName="phoneNumber" class="form-input"
               placeholder="+387 6X XXX XXX"
               [class.invalid]="hasError('phoneNumber', 'required') || hasError('phoneNumber', 'pattern')" />
        @if (hasError('phoneNumber', 'required')) {
          <span class="form-error">Telefon je obavezan.</span>
        }
        @if (hasError('phoneNumber', 'pattern')) {
          <span class="form-error">Format: +387 6X XXX XXX ili 06X XXX XXX</span>
        }
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="isSaving() || form.pristine">
          @if (isSaving()) {
            <div class="spinner-small"></div>
            Spremanje...
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
            </svg>
            Spremi promjene
          }
        </button>
      </div>
    </form>
  }
</div>
